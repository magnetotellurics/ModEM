# Makefile suited for building the ModEM program
# Generated using: ./fmkmf.pl [OPTIONS] ModEM.f90 > Makefile
# with command line options
# -p .:Classes:Classes/1D:Classes/2D:Classes/CSEM:Classes/DataIO:Classes/DataSpace:Classes/Fields:Classes/ForwardSolver:Classes/Grid:Classes/ModelOperator:Classes/ModelParameter:Classes/Receivers:Classes/Solver:Classes/Source:Classes/Transmitters:Classes/Utils
# -f90 gfortran (compiler)
# -opt -O3 -ffree-line-length-none (compiler optimisation)
# -lp /usr/lib64 (linking options: path to libraries)
# -l -llapack -lblas (linking options)
# -o objs/MT3D_OO_SERIAL (output directory for object files)

#  Uncomment these lines to make program for Solaris OS (legacy)
# F90 = f90
# FFLAGS = -dalign -g -C -w  -L/usr/local/lib
# LIBS = -xlic_lib=sunperf
#  Uncomment these lines to make program with g95
# include Makefile.local
# OBJDIR = ./objs/3D_MT/G95Debug
# F90 = g95
# FFLAGS = -O2
# FFLAGS = -g -ftrace=frame -fbounds-check
# MPIFLAGS = -cpp # for serial code
# MODULE = -fmod=$(OBJDIR)
# LIBS = -lblas -llapack
#  Uncomment these lines to make program with Intel compiler
# include Makefile.local
# OBJDIR = ./objs/3D_MT/IFortDebug
# F90 = ifort
# FFLAGS = -O3 -parallel -openmp #-heap-arrays
# FFLAGS = -debug all -check bounds -traceback -heap-arrays
# MPIFLAGS = -cpp # for serial code
# MODULE = -module $(OBJDIR)
# LIBS = -lblas -llapack
#  Uncomment these lines to make program with PGI compiler
# include Makefile.local
# OBJDIR = ./objs/3D_MT/PGIDebug
# F90 = pgf95  # mpif90
# FFLAGS = -O3
# FFLAGS = -g -Mprof=lines -Mbounds
# MPIFLAGS = -Mpreprocess # for serial code
# MPIFLAGS = -Bstatic  -Mipa=fast  -Mextend  -Kieee -Mpreprocess -DMPI
# MODULE = -module $(OBJDIR)
# LIBS = -llapack -lblas
# LIBS = -L/usr/lib64 -llapack -lblas -lpgftnrtl -Mprof=lines

# ------------------Macro-Defs---------------------
include Makefile.local
OBJDIR = ../../objs/MT3D_OO
F90 = gfortran
FFLAGS = -O3 -ffree-line-length-none
MPIFLAGS =  
MODULE = -J $(OBJDIR)
LIBS_PATH = -L/usr/lib64
LIBS = -llapack -lblas

# -------------------End-macro-Defs---------------------------
OBJ = $(OBJDIR)/ModEM.o 


all: ModEM 

# Here is the link step 
ModEM: $(OBJDIR) $(OBJ) 
	 $(F90) -o $(OUTDIR)/ModEM $(OBJ) $(LIBS_PATH) $(LIBS)

# Here are the compile steps 

$(OBJDIR): 
	mkdir -p $(OBJDIR)

$(OBJDIR)/ModEM.o:ModEM.f90  
	 $(F90) -c $(MODULE) $(FFLAGS) $(MPIFLAGS) ModEM.f90 -o $(OBJDIR)/ModEM.o

# Type " make clean " to get rid of all object and module files 
clean: 
	cd $(OBJDIR); \
	rm -f *~ *.o *.obj *.mod *.d *.s00 *.dbg *.stackdump \
	`find . -mindepth 1 -name "*~"` 

cleanall: clean 
	rm -f $(OUTDIR)/ModEM 

src: clean 
	tar cvfz $(ARCHIVE).tgz * 

  
